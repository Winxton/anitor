<!DOCTYPE html>
<html lang="en">
<head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
</head>

<body>
<h3>Anime Listings</h3>
Search: <input type="text" id="anime_search"/><br><br>

<div id = "anime_listings">
{% for anime in animeList %}
        <b>{{ anime.official_title }}</b> <br>
        Current Episode: {{ anime.current_episode.max_episode }}<br/>
        {% for torrent in anime.latest_episodes %}
            {{ torrent.fansub }}
            {{ torrent.episode }}
            {{ torrent.quality }}
            <br>
        {% endfor %}
        <br>
{% endfor %}
</div>

<script>

function boldSelected(str, s, e) {
    return str.substring(0, s) + "<b>" + str.substring(s,e) + "</b>" + str.substring(e);
}

//var searchURL = "/get-anime-list/";
$('#anime_search').keyup(function() {
    searchTerm = this.value.toLowerCase();
    
    $.get(
        "{% url 'animeList' %}", 
        {search:searchTerm},
        function(response) {
            $("#anime_listings").empty();
            $.each
            (
                response,
                function(ani_key, ani_value) {
                    var startIdx = ani_value['title'].toLowerCase().indexOf(searchTerm);
                    var endIdx = startIdx + searchTerm.length;
                    var html = ani_key +" "+ boldSelected(ani_value['title'], startIdx, endIdx);
                    
                    var torrents = ani_value['torrents'];

                    $.each(
                        torrents,
                        function(tor_key, tor_val) {
                            html += "<br>";
                            html += (tor_val['fansub']);
                            html += (tor_val['quality']);
                        }
                    );
                    
                    html += '<br><br>'
                    
                    $("#anime_listings").append(html);
                }
            );
        },
        "json"
    );

});
</script>
</body>
</html>