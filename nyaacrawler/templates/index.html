{% load staticfiles %}
{% load nyaacrawler_extras %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Anitor Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Loading Bootstrap -->
    <link href="{% static 'nyaacrawler/bootstrap/css/bootstrap.css' %}" rel="stylesheet">

    <!-- Loading Flat UI -->
    <link href="{% static 'nyaacrawler/css/flat-ui.css' %}" rel="stylesheet">
    <link rel="shortcut icon" href="{% static 'nyaacrawler/images/favicon.ico' %}">

    <!--Loading jquery library -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

    <!-- Loading Scrollbar -->
    <link href="{% static 'nyaacrawler/custom-scrollbar-plugin/jquery.mCustomScrollbar.css' %}" rel="stylesheet" type="text/css" />
    <script src="{% static 'nyaacrawler/custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js' %}"></script>

    <!-- Loading custom CSS -->
    <link href="{% static 'nyaacrawler/css/test1.css' %}" rel="stylesheet">

    <!--Loading fancyBox -->
    <script type="text/javascript" src="{% static 'nyaacrawler/fancyBox/source/jquery.fancybox.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'nyaacrawler/fancyBox/source/jquery.fancybox.css' %}" media="screen" />

    <!--Loading checkbox and radio Javascript -->
    <script src="{% static 'nyaacrawler/js/flatui-checkbox.js' %}"></script>
    <script src="{% static 'nyaacrawler/js/flatui-radio.js' %}"></script>

    <!--Loading custom Javascript -->
    <script type="text/javascript" src="{% static 'nyaacrawler/js/test.js' %}"></script>

  </head>
  <body>
    <input type="text" id="anime_search"/>
  
    {% for anime in animeList %}
    {% if anime.current_episode > 0 %}
    <div class="sub-wrapper" id="{{ anime.pk }}">
        <div class="element-border">
            <div class="image">
                <img src="{{ anime.image }}"/>
            </div><!--
            --><div class="data-container">
                <div class="anime-title">
                    {{ anime.official_title }}
                </div>
                <div class="ep-navigation nav-bar">
                <ul>
                    <li class="previous"><a href="#fakelink" class="fui-arrow-left nav-arrow"></a></li>
                    <li class="ep-number">
                        <div class="dropdown-ep">
                            <select name="Episode" class="select-block">
                            <option value="1">Episode 20</option>
                            <option value="2">Episode 2</option>
                            </select>
                        </div>
                    </li>
                    <li class="next"><a href="#fakelink" class="fui-arrow-right nav-arrow"></a></li>
                </ul>
                <a href="#inline1" class="btn btn-block btn-primary subscribe fancybox">Subscribe</a>
                </div>
                <div class="table-header">
                    <table>
                        <tr align=left>
                            <th class="fansub-head">Fansub Group</th>
                            <th class="quality-head">Quality</th>
                            <th class="size-head">Size</th>
                            <th class="seed-head">Seed</th>
                            <th class="leach-head">Leech</th>
                        </tr>
                    </table>
                </div>
                <div class="table-data">
                    <table class="anime-data">      
                        {% for torrent in anime.latest_episodes %}      
                        <tr>
                            <td class="fansub">{{ torrent.fansub }}</td>
                            <td class="quality">{{ torrent.quality }}</td>
                            <td class="file-size">{{ torrent.file_size }}</td>
                            <td class="seed">{{ torrent.seeders }}</td>
                            <td class="leach">{{ torrent.leechers }}</td>                       
                            <td class="magnet"><a href="{{ torrent|magnet_link }}" class="btn btn-block magtor">Magnet</a></td>
                            <td class="torrent"><a href="{{ torrent.url }}" class="btn btn-block magtor">Torrent</a></td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    {% endfor %}

    <div id="inline1">
        <h3>Subscribe</h3>
        <div id="fansub-wrapper">
            <h4>Fansub</h4>
            <form>
                <label class="checkbox checkbox-all-fansub checked">
                    <input class="checkbox-option-all-fansub" type="checkbox" checked="checked" data-toggle="checkbox">
                    All
                </label>
                <div id="fansub-list">
                </div>
            </form>
        </div>
        <div id="quality-wrapper">
            <h4>Quality</h4>
            <form>
                <label class="checkbox checkbox-all-quality checked">
                    <input class="checkbox-option-all-quality" type="checkbox" checked="checked" data-toggle="checkbox">
                    Any
                </label>
                <div id="quality-list">
                </div>
            </form>
        </div>
        <br>
        <div id="email-wrapper">
            <form>
                <h4><b>Email</b> : <input type="text" name="email" id="email-box"/>
                <input type="submit" value="Subscribe" class="btn btn-block subscribe-final"/></h4>
            </form>
        </div>
        <div id="subscribe-wrapper">

        </div>
        <div class="alert alert-error" id="alert-error-private">
            <button type="button" class="close"></button>
            <strong>Error! </strong>Please put in your correct email address
        </div>
    </div> 
    </div>
  </body>

<div id = "arrival"></div>

  <script>
    function boldSelected(str, s, e) {
    return str.substring(0, s) + "<b>" + str.substring(s,e) + "</b>" + str.substring(e);
    }
          $('#anime_search').keyup(function() {
        searchTerm = this.value.toLowerCase();
        
        $.get(
            "/search/get-anime-list/", 
            {search:searchTerm},
            function(response) {
                $(".sub-wrapper").remove();
                $.each
                (
                    response,
                    function(ani_key, ani_value) {
                        var startIdx = ani_value['title'].toLowerCase().indexOf(searchTerm);
                        var endIdx = startIdx + searchTerm.length;
                        //var html = "<br/>"+ani_key +" "+ boldSelected(ani_value['title'], startIdx, endIdx);
                        
                        var torrents = ani_value['torrents'];

                        var html = "" + 
                            "<div class='sub-wrapper' id='2'>" +
                            "<div class='element-border'>" +
                                "<div class='image'>" +
                                    "<img src='/static/nyaacrawler/shigeki.jpg'/>" +
                                "</div>" +
                                "<div class='data-container'>" +
                                    "<div class='anime-title'>" +
                                        boldSelected(ani_value['title'], startIdx, endIdx)+
                                    "</div>" +
                                    "<div class='ep-navigation nav-bar'>" +
                                    "<ul>" +
                                        "<li class='previous'><a href='#fakelink' class='fui-arrow-left nav-arrow'></a></li>" +
                                        "<li class='ep-number'><div class='dropdown-ep'>"+
                                            "<select name='Episode' class='select-block'>"+
                                            "<option value='1'>Episode 20</option>"+
                                            "<option value='2'>Episode 2</option>"+
                                            "</select>"+
                                            "<div class='btn-group select select-block'>"+
                                                "<i class='dropdown-arrow dropdown-arrow-inverse'></i>"+
                                                "<button class='btn dropdown-toggle clearfix btn-primary' data-toggle='dropdown'>"+
                                                "<span class='filter-option pull-left'>Episode  20</span>"+
                                                "&nbsp;"+
                                                "<span class='caret'></span>"+
                                                "</button>"+
                                                "<ul class='dropdown-menu dropdown-inverse mCustomScrollbar _mCS_2' role='menu' + style='max-height: 552px; overflow-y:auto; min-height: 75px;overflow-x:hidden'>"+
                                                "<div class='mCustomScrollBox mCS-light-thick' id='mCSB_2' style='position: relative; height: 100%; overflow: hidden; max-width: 100%; max-height: 205px;'>"+
                                                "<div class='mCSB_container mCS_no_scrollbar' style='position: relative; top: 0px;'>"+
                                                "<li rel='0' class='selected'><a tabindex='-1' href='#' class=''><span class='pull-left'>Episode  20</span></a></li>"+
                                                "<li rel='1'><a tabindex='-1' href='#' class=''><span class='pull-left'>Episode 2</span></a></li></div><div class='mCSB_scrollTools' style='position: absolute; display: none;'>"+
                                                "<div class='mCSB_draggerContainer'><div class='mCSB_dragger' style='position: absolute; top: 0px;' oncontextmenu='return false;'>"+
                                                "<div class='mCSB_dragger_bar' style='position:relative;'></div></div><div class='mCSB_draggerRail'+></div></div></div></div></ul></div>"+
                                        "</div></li>" +
                                        "<li class='next'><a href='#fakelink' class='fui-arrow-right nav-arrow'></a></li>" +
                                    "</ul>" +
                                    "<a href='#inline1' class='btn btn-block btn-primary subscribe fancybox'>Subscribe</a>" +
                                    "</div>" +
                                    "<div class='table-header'>" +
                                        "<table>" +
                                            "<tr align=left>" +
                                                "<th class='fansub-head'>Fansub Group</th>" +
                                                "<th class='quality-head'>Quality</th>" +
                                                "<th class='size-head'>Size</th>" +
                                                "<th class='seed-head'>Seed</th>" +
                                                "<th class='leach-head'>Leech</th>" +
                                            "</tr>" +
                                        "</table>" +
                                    "</div>" +
                                    "<div class='table-data'>"+
                                    "<table class='anime-data'>";
                                    var stringtest;
                                    $.each(
                                        torrents,
                                        function(tor_key, tor_val) {
                                    html+="<tr> " +
                                                "<td class='fansub'>";
                                                if(tor_val['fansub']!=stringtest)
                                                    html+=(tor_val['fansub']);
                                                html+= "</td>" +
                                                "<td class='quality'>";
                                                html+=(tor_val['quality']);
                                                html+="</td>" +
                                                "<td class='file-size'>";
                                                html+=(tor_val['file_size']);
                                                html+="</td>" +
                                                "<td class='seed'>";
                                                html+=(tor_val['seeders']);
                                                html+="</td>" +
                                                "<td class='leach'>";
                                                html+=(tor_val['leechers'])
                                                html+="</td>" +
                                                "<td class='magnet'><a href='#fakelink' class='btn btn-block magtor'>Magnet</a></td>" +
                                                "<td class='torrent'><a href='#fakelink' class='btn btn-block magtor'>Torrent</a></td>" +
                                            "</tr>" ;
                                            stringtest=(tor_val['fansub']);
                                        }
                                        );
$.each(
                                        torrents,
                                        function(tor_key, tor_val) {
                                    html+="<tr> " +
                                                "<td class='fansub'>";
                                                if(tor_val['fansub']!=stringtest)
                                                    html+=(tor_val['fansub']);
                                                html+= "</td>" +
                                                "<td class='quality'>";
                                                html+=(tor_val['quality']);
                                                html+="</td>" +
                                                "<td class='file-size'>";
                                                html+=(tor_val['file_size']);
                                                html+="</td>" +
                                                "<td class='seed'>";
                                                html+=(tor_val['seeders']);
                                                html+="</td>" +
                                                "<td class='leach'>";
                                                html+=(tor_val['leechers'])
                                                html+="</td>" +
                                                "<td class='magnet'><a href='#fakelink' class='btn btn-block magtor'>Magnet</a></td>" +
                                                "<td class='torrent'><a href='#fakelink' class='btn btn-block magtor'>Torrent</a></td>" +
                                            "</tr>" ;
                                            stringtest=(tor_val['fansub']);
                                        }
                                        );
                                    html+="</table>"+
                                    "</div>" +
                                "</div>" +
                            "</div>" +
                            "</div>";

                            $("#arrival").append(html);
                            //bindScrollBar();
                    }
                );
            },
            "json"
        );
    }); 

  </script>

    <script type="text/javascript" src="{% static 'nyaacrawler/js/bootstrap.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'nyaacrawler/js/bootstrap-select.js' %}"></script>
    <script type="text/javascript" src="{% static 'nyaacrawler/js/application.js' %}"></script>